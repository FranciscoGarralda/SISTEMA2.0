#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

console.log('üóÑÔ∏è  CONFIGURACI√ìN DE BASE DE DATOS - SISTEMA 2.0');
console.log('================================================\n');

// Verificar si existe el archivo de configuraci√≥n de Neon
const neonConfigPath = 'netlify/functions/setup-db.js';
if (fs.existsSync(neonConfigPath)) {
  console.log('‚úÖ Configuraci√≥n de base de datos encontrada');
  
  // Leer y mostrar la configuraci√≥n
  const setupContent = fs.readFileSync(neonConfigPath, 'utf8');
  console.log('üìã Configuraci√≥n actual:');
  console.log(setupContent);
} else {
  console.log('‚ùå Configuraci√≥n de base de datos no encontrada');
}

// Crear script de inicializaci√≥n de datos de prueba
const seedData = `// Datos de prueba para el sistema
const testData = {
  users: [
    {
      id: 1,
      username: 'admin',
      password: 'admin', // En producci√≥n usar hash
      name: 'Administrador',
      role: 'admin',
      email: 'admin@sistema2.com'
    }
  ],
  clients: [
    {
      id: 1,
      nombre: 'Cliente Demo',
      apellido: 'Test',
      telefono: '+54 11 1234-5678',
      email: 'demo@test.com',
      dni: '12345678',
      direccion: 'Calle Demo 123'
    }
  ],
  movements: [
    {
      id: 1,
      tipo: 'compra',
      monto: 1000,
      moneda: 'USD',
      cliente_id: 1,
      fecha: new Date().toISOString(),
      estado: 'completado'
    }
  ]
};

console.log('üå± Datos de prueba cargados:', testData);
module.exports = testData;`;

fs.writeFileSync('scripts/seed-data.js', seedData);
console.log('‚úÖ Script de datos de prueba creado');

// Crear instrucciones de configuraci√≥n
const instructions = `
üìã INSTRUCCIONES PARA CONFIGURAR LA BASE DE DATOS:

1. CREAR CUENTA EN NEON:
   - Ve a https://neon.tech
   - Crea una cuenta gratuita
   - Crea un nuevo proyecto

2. CONFIGURAR VARIABLES DE ENTORNO:
   - Copia la URL de conexi√≥n de Neon
   - Actualiza .env.local con la URL real

3. EJECUTAR MIGRACIONES:
   - npm run db:setup
   - npm run db:seed

4. VERIFICAR CONEXI√ìN:
   - npm run health

üîó URL de ejemplo para .env.local:
DATABASE_URL=postgresql://usuario:password@ep-xxxxx.us-east-2.aws.neon.tech/sistema2_0
`;

fs.writeFileSync('DATABASE_SETUP.md', instructions);
console.log('‚úÖ Instrucciones de configuraci√≥n creadas');

console.log('\nüéØ CONFIGURACI√ìN COMPLETA');
console.log('Revisa DATABASE_SETUP.md para las instrucciones detalladas');
